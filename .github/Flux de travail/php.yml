name: PHP Composer

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

permissions:
  contents: read

jobs:
  build:

    runs-on: [ubuntu-latest , windows ]

    steps:
    - uses: actions/checkout@v3

    - name: Validate composer.json and composer.lock
      run: composer validate --strict

    - name: Cache Composer packages
      id: composer-cache
      uses: actions/cache@v3
      with:
        path: vendor
        key: ${{ runner.os }}-php-${{ hashFiles('**/composer.lock') }}
        restore-keys: |
          ${{ runner.os }}-php-

    - name: Install dependencies
      run: composer install --prefer-dist --no-progress

    # Add a test script to composer.json, for instance: "test": "vendor/bin/phpunit"
    # Docs: https://getcomposer.org/doc/articles/scripts.md

    # - name: Run test suite
    #   run: composer run-script test
    
    - name: PHPUnit (php-actions)
  # You may pin to the exact commit or the version.
  # uses: php-actions/phpunit@aed47a6852905dbd05b7c1a47c526b38fcc4bc17
  uses: php-actions/phpunit@v3
  with:
    # What version of PHPUnit to use
    version: # optional, default is latest
    # What version of PHP to use
    php_version: # optional, default is latest
    # Space separated list of extensions to configure with the PHP build
    php_extensions: # optional
    # Path to a vendored phpunit binary
    vendored_phpunit_path: # optional
    # Configuration file location
    configuration: # optional
    # JUnit output file location
    log_junit: # optional
    # JUnit output file location
    log_teamcity: # optional
    # JUnit output file location
    testdox_html: # optional
    # JUnit output file location
    testdox_text: # optional
    # JUnit output file location
    testdox_xml: # optional
    # Memory limit
    memory_limit: # optional
    # Path to bootstrap file
    bootstrap: # optional
    # Filter which tests to run
    filter: # optional
    # Specify a testsuite to run
    testsuite: # optional
    # Only runs tests from the specified group(s)
    group: # optional
    # Exclude tests from the specified group(s)
    exclude_group: # optional
    # Only search for test in files with specified suffix(es)
    test_suffix: # optional, default is Test.php,.phpt
    # Path to directory to whitelist for code coverage analysis
    whitelist: # optional
    # Extra arguments to pass to the phpunit binary
    args: # optional
